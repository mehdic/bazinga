<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAZINGA Orchestration Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/enhanced-features.css">
    <!-- Mermaid for workflow diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <!-- Marked for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.0.0/marked.min.js"></script>
    <!-- D3.js for timeline and Gantt charts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <!-- Configuration Modal -->
    <div class="modal" id="config-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>‚öôÔ∏è Dashboard Configuration</h3>
                <button class="modal-close" id="close-config-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="config-section">
                    <h4>General Settings</h4>
                    <div class="config-item">
                        <label>
                            <input type="checkbox" id="config-ai-diagrams">
                            Enable AI-Generated Diagrams
                        </label>
                    </div>
                    <div class="config-item">
                        <label>
                            <input type="checkbox" id="config-browser-notifs">
                            Enable Browser Notifications
                        </label>
                    </div>
                    <div class="config-item">
                        <label>
                            <input type="checkbox" id="config-sound-alerts">
                            Enable Sound Alerts
                        </label>
                    </div>
                    <div class="config-item">
                        <label>
                            Theme:
                            <select id="config-theme">
                                <option value="dark">Dark</option>
                                <option value="light">Light</option>
                            </select>
                        </label>
                    </div>
                    <div class="config-item">
                        <label>
                            Update Frequency (ms):
                            <input type="number" id="config-update-freq" min="500" max="10000" step="500" value="1000">
                        </label>
                    </div>
                    <div class="config-item">
                        <label>
                            Session Retention (days):
                            <input type="number" id="config-retention-days" min="1" max="365" value="30">
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h4>Notifications</h4>
                    <div class="config-item">
                        <label>
                            <input type="checkbox" id="config-email-enabled">
                            Enable Email Notifications
                        </label>
                    </div>
                    <div class="config-item">
                        <label>
                            SMTP Server:
                            <input type="text" id="config-smtp-server" placeholder="smtp.gmail.com">
                        </label>
                    </div>
                    <div class="config-item">
                        <label>
                            SMTP Port:
                            <input type="number" id="config-smtp-port" value="587">
                        </label>
                    </div>
                    <div class="config-item">
                        <label>
                            From Email:
                            <input type="email" id="config-from-email" placeholder="bot@example.com">
                        </label>
                    </div>
                    <div class="config-item">
                        <label>
                            To Emails (comma-separated):
                            <input type="text" id="config-to-emails" placeholder="team@example.com, alerts@example.com">
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h4>Slack Integration</h4>
                    <div class="config-item">
                        <label>
                            <input type="checkbox" id="config-slack-enabled">
                            Enable Slack Notifications
                        </label>
                    </div>
                    <div class="config-item">
                        <label>
                            Webhook URL:
                            <input type="text" id="config-slack-webhook" placeholder="https://hooks.slack.com/services/...">
                        </label>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn-secondary" id="config-cancel">Cancel</button>
                    <button class="btn-primary" id="config-save">Save Configuration</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Search/Filter Bar -->
    <div class="search-bar" id="search-bar">
        <div class="search-controls">
            <input type="text" id="search-input" placeholder="üîç Search sessions..." />
            <button class="btn-icon" id="filter-toggle" title="Toggle filters">
                <span>üéõÔ∏è</span>
            </button>
            <button class="btn-icon" id="config-btn" title="Settings">
                <span>‚öôÔ∏è</span>
            </button>
        </div>
        <div class="filter-panel" id="filter-panel" style="display: none;">
            <div class="filter-group">
                <label>Status:</label>
                <select id="filter-status">
                    <option value="">All</option>
                    <option value="running">Running</option>
                    <option value="completed">Completed</option>
                    <option value="failed">Failed</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Date From:</label>
                <input type="date" id="filter-date-from" />
            </div>
            <div class="filter-group">
                <label>Date To:</label>
                <input type="date" id="filter-date-to" />
            </div>
            <button class="btn-secondary btn-sm" id="clear-filters">Clear</button>
            <button class="btn-primary btn-sm" id="apply-filters">Apply</button>
        </div>
    </div>

    <!-- Session Navigation Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>üìÅ Sessions</h2>
            <button class="toggle-btn" id="sidebar-toggle">‚óÄ</button>
        </div>
        <div class="sidebar-actions">
            <button class="btn-secondary btn-sm" id="refresh-sessions">üîÑ</button>
            <button class="btn-secondary btn-sm" id="compare-sessions">‚öñÔ∏è</button>
        </div>
        <div class="sessions-list" id="sessions-list">
            <div class="loading">Loading sessions...</div>
        </div>
    </aside>

    <!-- Main Dashboard -->
    <main class="main-content">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-top">
                <div class="logo">
                    <h1>üöÄ BAZINGA</h1>
                    <span class="subtitle">Orchestration Dashboard</span>
                </div>
                <div class="header-actions">
                    <button class="btn-secondary" id="export-session">üì• Export</button>
                    <button class="btn-secondary" id="archive-session">üì¶ Archive</button>
                    <button class="btn-danger" id="delete-session">üóëÔ∏è Delete</button>
                </div>
                <div class="connection-status" id="connection-status">
                    <span class="status-dot"></span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>
            <div class="session-info" id="session-info">
                <div class="session-id">
                    <strong>Session:</strong>
                    <span id="session-id-text">Loading...</span>
                </div>
                <div class="session-status">
                    <span class="status-badge" id="status-badge">INITIALIZING</span>
                </div>
                <div class="session-time">
                    <strong>Started:</strong> <span id="start-time">--:--</span> |
                    <strong>Elapsed:</strong> <span id="elapsed-time">0m</span>
                </div>
                <div class="session-stats">
                    <span id="total-iterations">0 iterations</span>
                    <span id="total-spawns">0 spawns</span>
                </div>
            </div>
        </header>

        <!-- Progress Overview -->
        <section class="section progress-section">
            <h2>üìä Progress Overview</h2>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%">
                        <span class="progress-text" id="progress-text">0%</span>
                    </div>
                </div>
                <div class="progress-details">
                    <div class="progress-stat">
                        <span class="stat-label">Total Groups</span>
                        <span class="stat-value" id="total-groups">0</span>
                    </div>
                    <div class="progress-stat completed">
                        <span class="stat-label">‚úÖ Completed</span>
                        <span class="stat-value" id="completed-groups">0</span>
                    </div>
                    <div class="progress-stat in-progress">
                        <span class="stat-label">üîÑ In Progress</span>
                        <span class="stat-value" id="inprogress-groups">0</span>
                    </div>
                    <div class="progress-stat pending">
                        <span class="stat-label">‚è≥ Pending</span>
                        <span class="stat-value" id="pending-groups">0</span>
                    </div>
                </div>
                <div class="current-phase">
                    <strong>Current Phase:</strong>
                    <span id="current-phase" class="phase-badge">Initializing...</span>
                </div>
            </div>
        </section>

        <!-- Tabs for Different Views -->
        <section class="section">
            <div class="tabs">
                <button class="tab-btn active" data-tab="workflow">üó∫Ô∏è Workflow</button>
                <button class="tab-btn" data-tab="timeline">‚è±Ô∏è Timeline</button>
                <button class="tab-btn" data-tab="gantt">üìä Gantt Chart</button>
                <button class="tab-btn" data-tab="dependency">üîó Dependencies</button>
                <button class="tab-btn" data-tab="logs">üìú Logs</button>
            </div>

            <!-- Workflow Tab -->
            <div class="tab-content active" id="tab-workflow">
                <div class="section-header">
                    <h2>üó∫Ô∏è Workflow Visualization</h2>
                    <div class="workflow-controls">
                        <button class="btn-secondary" id="refresh-workflow">üîÑ Refresh</button>
                        <button class="btn-primary" id="generate-ai-diagram" style="display: none;">
                            ü§ñ Generate AI Diagram
                        </button>
                    </div>
                </div>
                <div class="workflow-container">
                    <div class="workflow-diagram" id="workflow-diagram">
                        <div class="placeholder">
                            <p>Workflow diagram will appear here once orchestration starts...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timeline Tab -->
            <div class="tab-content" id="tab-timeline">
                <h2>‚è±Ô∏è Agent Execution Timeline</h2>
                <div class="timeline-container" id="timeline-container">
                    <div class="placeholder">
                        <p>Timeline will appear once agents start working...</p>
                    </div>
                </div>
            </div>

            <!-- Gantt Chart Tab -->
            <div class="tab-content" id="tab-gantt">
                <h2>üìä Parallel Execution Gantt Chart</h2>
                <div class="gantt-container" id="gantt-container">
                    <div class="placeholder">
                        <p>Gantt chart will appear once agents start working...</p>
                    </div>
                </div>
            </div>

            <!-- Dependency Graph Tab -->
            <div class="tab-content" id="tab-dependency">
                <h2>üîó Task Dependency Graph</h2>
                <div class="dependency-container" id="dependency-container">
                    <div class="placeholder">
                        <p>Dependency graph will appear once PM creates task breakdown...</p>
                    </div>
                </div>
            </div>

            <!-- Logs Tab -->
            <div class="tab-content" id="tab-logs">
                <h2>üìú Real-Time Logs</h2>
                <div class="logs-controls">
                    <button class="btn-secondary btn-sm" id="logs-refresh">üîÑ Refresh</button>
                    <button class="btn-secondary btn-sm" id="logs-scroll-bottom">‚¨áÔ∏è Scroll to Bottom</button>
                    <label>
                        Auto-scroll:
                        <input type="checkbox" id="logs-autoscroll" checked>
                    </label>
                </div>
                <div class="logs-container" id="logs-container">
                    <pre id="logs-content">Waiting for logs...</pre>
                </div>
            </div>
        </section>

        <!-- Task Groups -->
        <section class="section groups-section">
            <h2>üì¶ Task Groups</h2>
            <div class="groups-container" id="groups-container">
                <div class="placeholder">
                    <p>Task groups will appear here once PM creates the breakdown...</p>
                </div>
            </div>
        </section>

        <!-- Agent Activity & Communication -->
        <div class="two-column">
            <!-- Agent Status -->
            <section class="section agent-status-section">
                <h2>üë• Agent Status</h2>
                <div class="agent-status-container" id="agent-status-container">
                    <div class="placeholder">
                        <p>Agent activity will appear here...</p>
                    </div>
                </div>
            </section>

            <!-- Communication Log -->
            <section class="section communication-section">
                <h2>üí¨ Recent Activity</h2>
                <div class="communication-container" id="communication-container">
                    <div class="placeholder">
                        <p>Agent communications will appear here...</p>
                    </div>
                </div>
            </section>
        </div>

        <!-- Quality Metrics (if available) -->
        <section class="section quality-section" id="quality-section" style="display: none;">
            <h2>üìà Quality Metrics</h2>
            <div class="quality-container" id="quality-container">
                <div class="quality-score">
                    <div class="score-circle" id="overall-score-circle">
                        <span class="score-value" id="overall-score">--</span>
                        <span class="score-label">Health</span>
                    </div>
                </div>
                <div class="quality-metrics">
                    <div class="metric-card" id="security-metric">
                        <h4>üîí Security</h4>
                        <div class="metric-value">--</div>
                        <div class="metric-trend"></div>
                    </div>
                    <div class="metric-card" id="coverage-metric">
                        <h4>üß™ Coverage</h4>
                        <div class="metric-value">--</div>
                        <div class="metric-trend"></div>
                    </div>
                    <div class="metric-card" id="lint-metric">
                        <h4>‚ú® Lint</h4>
                        <div class="metric-value">--</div>
                        <div class="metric-trend"></div>
                    </div>
                    <div class="metric-card" id="velocity-metric">
                        <h4>‚ö° Velocity</h4>
                        <div class="metric-value">--</div>
                        <div class="metric-trend"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- AI Diagram Modal -->
    <div class="modal" id="ai-diagram-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>ü§ñ AI-Generated Workflow Analysis</h3>
                <button class="modal-close" id="close-ai-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="ai-diagram-loading" id="ai-diagram-loading">
                    <div class="spinner"></div>
                    <p>Generating AI-powered workflow analysis...</p>
                </div>
                <div class="ai-diagram-content" id="ai-diagram-content" style="display: none;">
                    <div class="ai-narrative" id="ai-narrative"></div>
                    <div class="ai-insights" id="ai-insights"></div>
                    <div class="ai-diagram" id="ai-diagram-render"></div>
                </div>
                <div class="ai-diagram-error" id="ai-diagram-error" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Communication Detail Modal -->
    <div class="modal" id="communication-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Communication Details</h3>
                <button class="modal-close" id="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Session Comparison Modal -->
    <div class="modal" id="comparison-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>‚öñÔ∏è Session Comparison</h3>
                <button class="modal-close" id="close-comparison-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="comparison-selector">
                    <div>
                        <label>Session 1:</label>
                        <select id="compare-session1"></select>
                    </div>
                    <div>
                        <label>Session 2:</label>
                        <select id="compare-session2"></select>
                    </div>
                    <button class="btn-primary" id="run-comparison">Compare</button>
                </div>
                <div class="comparison-results" id="comparison-results" style="display: none;">
                    <!-- Comparison results -->
                </div>
            </div>
        </div>
    </div>

    <!-- Audio for notifications -->
    <audio id="notification-sound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSyF0fPTgjMGHm7A7+OZUQ0BVQAA" type="audio/wav" />
    </audio>

    <!-- JavaScript Modules -->
    <script src="js/data-loader.js"></script>
    <script src="js/websocket-client.js"></script>
    <script src="js/workflow-viz.js"></script>
    <script src="js/agent-comms.js"></script>
    <script src="js/agent-status.js"></script>
    <script src="js/session-nav.js"></script>
    <script src="js/quality-metrics.js"></script>
    <script src="js/timeline.js"></script>
    <script src="js/gantt.js"></script>
    <script src="js/dependencies.js"></script>
    <script src="js/logs.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/config.js"></script>
    <script src="js/search.js"></script>
    <script src="js/session-mgmt.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
